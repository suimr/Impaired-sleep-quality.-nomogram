summary(model32)
summary(model33)
summary(model34)
str(log)
model <- glm(Depression ~ Gender+Married+Rural+SRH+Comorbidity+Drinkev+Drinkl+Smokev+Retire
+Life_satisfaction+Social+Disability+Edu+Exercise+Memeory+Executive+
TotalCognition+Iadl+Pain+Sleep_duration+Sleep_disorder+HDL+HGB+UA,data = tlog,
family = binomial(link="logit"),x=T)
summary(model)
# 
加
载
必
要
的
包
library(glmnet)
# 
提
取
因
变
量
和
自
变
量
y <- log$Depression
X <- as.matrix(log[, !names(tlog) %in% "Depression"])
# Lasso
回
归
# 
设
置alpha = 1 
表
示Lasso
回
归
（alpha = 0 
表
示Ridge
回
归
）
lasso_model <- glmnet(X, y, alpha = 1)
# 
查
看
模
型
print(lasso_model)
plot(lasso_model)
# 
使
用
交
叉
验
证
选
择
最
佳
的lambda
值
cv_lasso <- cv.glmnet(X, y, alpha = 1)
plot(cv_lasso)
# 
提
取
最
佳
的lambda
值,11
个
变
量
best_lambda <- cv_lasso$lambda.min
print(best_lambda)
lambda_1se<-cv_lasso$lambda.1se
print(lambda_1se)
coef_cv<-coef(cv_lasso,s=lambda_1se)
coef_cv
exp(coef_cv)
coef_cv<-as.matrix(coef_cv)
coef_cv<-data.frame(coef_cv)
coef_cv$OR<-exp(coef_cv$s1)#
计
算
每
一
个
变
量
的or
值
coef_cv$OR
nonezero_vars<-rownames(coef_cv[coef_cv$OR !=1,])
nonezero_vars
nonezero_vars<-nonezero_vars[2:13]
nonezero_vars
lasso_data<-tlog[,nonezero_vars]
View(lasso_data)
coef_cv$OR<-exp(nonezero_vars$s1)
#
从
一
个LASSO
回
归
模
型
中
提
取
出
在lambda.min
下
非
零
系
数
的
变
量
名
lasso_coef_matrix <- as.matrix(lasso_coef)
selected_variables <- rownames(lasso_coef_matrix)[lasso_coef_matrix != 0]
selected_variables <- selected_variables[-1] # 
去
掉
截
距
项
print(selected_variables)
#
建
立
多
因
素logistic
回
归(
基
于lasso
回
归
筛
选
的18
个
变
量
进
行
多
因
素
回
归)
model2 <- glm(Depression ~ SRH+Comorbidity+Life_satisfaction+Edu+TotalCognition+Iadl+Pain+Sleep_disorder,data = tlog,
family = binomial(link="logit"),x=T)
summary(model2)
#
多
因
素Logistic
回
归
fit1 <- glm(Depression ~ SRH+Comorbidity+Life_satisfaction+Edu+TotalCognition+Iadl+Pain+Sleep_disorder,data = tlog,
family = binomial(link = "logit"))
formatFit<-function(fit1){
#
取P
值
p<-summary(fit1)$coefficients[,4]
#wald
值
wald<-summary(fit1)$coefficients[,3]^2
#B
值
valueB<-coef(fit1)
#SE
值
SE <- summary(fit1)$coefficients[,2]
#OR
值
valueOR<-exp(coef(fit1))
#OR
值
得95%CI
confitOR<-exp(confint(fit1))
data.frame(
B=round(valueB,3),
SE=round(SE,3),
Wald=round(wald,3),
OR_with_CI=paste(round(valueOR,3),"(",
round(confitOR[,1],3),"~",
round(confitOR[,2],3),")",
sep=""),
P=format.pval(p,digits = 3,eps=0.001)
)
}
formatFit(fit1)
lj <- formatFit(fit1)
dd <- datadist(tlog)
library(rms)
dd <- datadist(tlog)
options(datadist = "dd")
logistic_model <- lrm(Depression ~ Rural+SRH+Life_satisfaction+Edu+Iadl+Pain+Sleep_disorder,data = tlog,x=T,y=T,maxit=5000)
print(logistic_model)
nomo<-nomogram(logistic_model,fun = plogis,lp=F,fun.at = c(0.1,seq(0.2,0.8,by=0.1),0.9),
funlabel = "Risk of Depression")
plot(nomo,col.grid=c("tomato","darkcyan"))
log $Gender<-factor(log$Gender,labels = c('Femal','Male'))
log $Marital_Status<-factor(log$Marital_Status,labels = c('Separated/Widowedm/Divorced','Married'))
#l
列
线
图
因
子
化
log $Gender<-factor(log$Gender,labels = c('Femal','Male'))
log $Marital_Status<-factor(log$Marital_Status,labels = c('Separated/Widowedm/Divorced','Married'))
str(log)
log $Gender<-factor(log$Gender,labels = c('Femal','Male'))
log $Rural<-factor(log$Rural,labels=c('No','Yes'))
log $SRH<-factor(log$SRH,labels=c('Very poor','Poor','Fair','Good','Very good'))
log $Life_satisfaction<-factor(log$Life_satisfaction,labels=c('Not at all satisfied','Not very satisfied','Somewhat satisfied',
'Very satisfied','Completely satisfied'))
log $Education_level<-factor(log$Education_level,labels=c('Below primary school','Primary school',
'Middle school','High school and higher'))
setwd("D:/R")
file_path <- "1.xlsx"
log <- read_excel(file_path, sheet = "Sheet 1")
str(log)
#l
列
线
图
因
子
化
log $Gender<-factor(log$Gender,labels = c('Femal','Male'))
log $Rural<-factor(log$Rural,labels=c('No','Yes'))
log $SRH<-factor(log$SRH,labels=c('Very poor','Poor','Fair','Good','Very good'))
log $Life_satisfaction<-factor(log$Life_satisfaction,labels=c('Not at all satisfied','Not very satisfied','Somewhat satisfied',
'Very satisfied','Completely satisfied'))
log $Education_level<-factor(log$Education_level,labels=c('Below primary school','Primary school',
'Middle school','High school and higher'))
log $IADL<-factor(log$IADL ,labels=c('No','Yes'))
log $Iadl<-factor(log$Iadl ,labels=c('No','Yes'))
log $Pain <-factor(log$Pain ,labels=c('No','Yes'))
log $Sleep_disorder <-factor(log$Sleep_disorder,labels=c('<1 day','1-2days','3-4days','5-7days'))
log $Comorbid_chronic_diseases  <-factor(log$Comorbid_chronic_diseases,labels=c('None','1 kind','2 kinds and above'))
log $Gender<-factor(log$Gender,labels = c('Femal','Male'))
log $Rural<-factor(log$Rural,labels=c('No','Yes'))
log $SRH<-factor(log$SRH,labels=c('Very poor','Poor','Fair','Good','Very good'))
log $Life_satisfaction<-factor(log$Life_satisfaction,labels=c('Not at all satisfied','Not very satisfied','Somewhat satisfied',
'Very satisfied','Completely satisfied'))
log $Education_level<-factor(log$Education_level,labels=c('Below primary school','Primary school',
'Middle school','High school and higher'))
log $Iadl<-factor(log$Iadl ,labels=c('No','Yes'))
log $Pain <-factor(log$Pain ,labels=c('No','Yes'))
log $Sleep_disorder <-factor(log$Sleep_disorder,labels=c('<1 day','1-2days','3-4days','5-7days'))
##
动
态
列
线
图
分
子
话
处
理
# 2 
分
类
log$Depressive<-factor(log$Depressive,levels = c(0,1),labels = c("No","Yes"))
table(log$Depressive)
##
动
态
列
线
图
分
子
话
处
理
# 2 
分
类
log$Depression<-factor(log$Depression,levels = c(0,1),labels = c("No","Yes"))
table(log$Depressive)
table(log$Depression)
#
婚
姻
log$Rural<-factor(log$Rural,levels = c(0,1),
labels = c("No","Yes"))
table(log$Marital_Status)
table(log$Rural)
dd <- datadist(tlog)
options(datadist = "dd")
logistic_model <- lrm(Depression ~ Rural+SRH+Life_satisfaction+Edu+Iadl+Pain+Sleep_disorder,data = tlog,x=T,y=T,maxit=5000)
print(logistic_model)
nomo<-nomogram(logistic_model,fun = plogis,lp=F,fun.at = c(0.1,seq(0.2,0.8,by=0.1),0.9),
funlabel = "Risk of Depression")
plot(nomo,col.grid=c("tomato","darkcyan"))
dd <- datadist(tlog)
options(datadist = "dd")
logistic_model <- lrm(Depression ~ Rural+SRH+Life_satisfaction+Edu+Iadl+Pain+Sleep_disorder,data = tlog,x=T,y=T,maxit=5000)
print(logistic_model)
nomo<-nomogram(logistic_model,fun = plogis,lp=F,fun.at = c(0.1,seq(0.2,0.8,by=0.1),0.9),
funlabel = "Risk of Depression")
dd <- datadist(tlog)
options(datadist = "dd")
logistic_model <- lrm(Depression ~ Rural+SRH+Life_satisfaction+Edu+Iadl+Pain+Sleep_disorder,data = tlog,x=T,y=T,maxit=5000)
print(logistic_model)
nomo<-nomogram(logistic_model,fun = plogis,lp=F,fun.at = c(0.1,seq(0.2,0.8,by=0.1),0.9),
funlabel = "Risk of Depression")
plot(nomo,col.grid=c("tomato","darkcyan"))
library(readxl)
library(rms)
setwd("D:/R")
file_path <- "
分
类.xlsx"
log <- read_excel(file_path, sheet = "
最
后
变
量")
str(log)
setwd("D:/R")
file_path <- "1.xlsx"
log <- read_excel(file_path, sheet = "Sheet 1")
str(log)
log $Gender<-factor(log$Gender,labels = c('Femal','Male'))
log $Rural<-factor(log$Rural,labels=c('No','Yes'))
log $SRH<-factor(log$SRH,labels=c('Very poor','Poor','Fair','Good','Very good'))
log $Life_satisfaction<-factor(log$Life_satisfaction,labels=c('Not at all satisfied','Not very satisfied','Somewhat satisfied',
'Very satisfied','Completely satisfied'))
log $Education_level<-factor(log$Education_level,labels=c('Below primary school','Primary school',
'Middle school','High school and higher'))
log $Iadl<-factor(log$Iadl ,labels=c('No','Yes'))
log $Pain <-factor(log$Pain ,labels=c('No','Yes'))
log $Sleep_disorder <-factor(log$Sleep_disorder,labels=c('<1 day','1-2days','3-4days','5-7days'))
library(caret)
set.seed(20240414) #
设
置
随
机
种
子
#
产
生
随
机
数
字
randnum<- createDataPartition(y=log$Depressive,p=0.7,list = FALSE)
#
根
据
随
机
数
字
，
产
生
训
练
集
数
据
集
tlog<-log[randnum,]
library(caret)
set.seed(20240414) #
设
置
随
机
种
子
#
产
生
随
机
数
字
randnum<- createDataPartition(y=log$Depression,p=0.7,list = FALSE)
#
根
据
随
机
数
字
，
产
生
训
练
集
数
据
集
tlog<-log[randnum,]
#
根
据
随
机
数
字
，
产
生
验
证
集
数
据
集
valdata<-log[-randnum,]
###
拟
合
模
型
fit.glm <- glm(Depression ~ Rural+SRH+Life_satisfaction+Edu+Iadl+Pain+Sleep_disorder,
data = tlog,family = binomial())
###
拟
合
模
型
fit.glm <- glm(Depression ~ Rural+SRH+Life_satisfaction+Education_level+Iadl+Pain+Sleep_disorder,
data = tlog,family = binomial())
##
建
立
动
态
列
线
图
library(DynNom)
DNbuilder(fit.glm,covariate = "numeric")
##
加
载R
install.packages("rsconnect")
library(rsconnect)
###
注
册
账
号
#www.shinyapps.io
#
密
钥
rsconnect::setAccountInfo(name='suntongxin',
token='152F490697DF4939A618BE4B5CAEE9AE',
secret='l+37Diiqz3R8AtyFLTPWfSZBUbDm36MtrRVHt96G')
#
确
定
路
径
dir<-getwd()
path<-paste0(dir,"/DynNomapp",collapse = "")
path
#
布
置
网
络
#
输
入
自
己
的
路
径
名
称
rsconnect::deployApp("D:/R/DynNomapp")
dd <- datadist(tlog)
options(datadist = "dd")
logistic_model <- lrm(Depression ~ Rural+SRH+Life_satisfaction+Edu+Iadl+Pain+Sleep_disorder,data = tlog,x=T,y=T,maxit=5000)
print(logistic_model)
logistic_model <- lrm(Depression ~ Rural+SRH+Life_satisfaction+Education_level+Iadl+Pain+Sleep_disorder,data = tlog,x=T,y=T,maxit=5000)
print(logistic_model)
nomo<-nomogram(logistic_model,fun = plogis,lp=F,fun.at = c(0.1,seq(0.2,0.8,by=0.1),0.9),
funlabel = "Risk of Depression")
plot(nomo,col.grid=c("tomato","darkcyan"))
shiny::runApp('DynNomapp')
q()
